<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR KPI Dashboard</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        a-scene {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
        }
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden; 
        }
        #statusButton {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Botão para exibir os gauges -->
    <button id="statusButton">Status</button>

    <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; videoTexture: true; debugUIEnabled: false">
        <!-- Gauge OEE -->
        <a-entity id="gauge-OEE" position="-1.5 0.5 0" scale="1.2 1.2 1.2" visible="false">
            <a-ring id="ring-OEE" color="blue" radius-inner="0.5" radius-outer="0.6" theta-start="0" theta-length="0"></a-ring>
            <a-text id="text-OEE" value="OEE: 0%" position="0 0.8 0" align="center" color="white"></a-text>
        </a-entity>

        <!-- Gauge Disponibilidade -->
        <a-entity id="gauge-Disponibilidade" position="-0.5 0.5 0" scale="1.2 1.2 1.2" visible="false">
            <a-ring id="ring-Disponibilidade" color="orange" radius-inner="0.5" radius-outer="0.6" theta-start="0" theta-length="0"></a-ring>
            <a-text id="text-Disponibilidade" value="Disp: 0%" position="0 0.8 0" align="center" color="white"></a-text>
        </a-entity>

        <!-- Gauge Performance -->
        <a-entity id="gauge-Performance" position="0.5 0.5 0" scale="1.2 1.2 1.2" visible="false">
            <a-ring id="ring-Performance" color="green" radius-inner="0.5" radius-outer="0.6" theta-start="0" theta-length="0"></a-ring>
            <a-text id="text-Performance" value="Perf: 0%" position="0 0.8 0" align="center" color="white"></a-text>
        </a-entity>

        <!-- Gauge Qualidade -->
        <a-entity id="gauge-Qualidade" position="1.5 0.5 0" scale="1.2 1.2 1.2" visible="false">
            <a-ring id="ring-Qualidade" color="yellow" radius-inner="0.5" radius-outer="0.6" theta-start="0" theta-length="0"></a-ring>
            <a-text id="text-Qualidade" value="Qual: 0%" position="0 0.8 0" align="center" color="white"></a-text>
        </a-entity>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Função para obter valores aleatórios entre 0 e 100
        function getRandomInitialValue() {
            return Math.floor(Math.random() * 101);  // Valor aleatório entre 0 e 100
        }

        // Função para obter valores aleatórios que mudam gradualmente
        function getRandomValue(currentValue) {
            const randomChange = Math.floor(Math.random() * 11) - 5;  // Valor aleatório entre -5 e 5
            let newValue = currentValue + randomChange;
            newValue = Math.max(0, Math.min(newValue, 100));  // Limita entre 0 e 100
            return newValue;
        }

        // Função para atualizar o valor, a cor e o preenchimento do gauge
        function updateGauge(value, textId, ringId) {
            // Atualiza o texto
            const textEntity = document.getElementById(textId);
            textEntity.setAttribute('value', textId.split('-')[1] + ': ' + value + '%');
            
            // Atualiza a cor com base no valor (0% = vermelho, 100% = verde)
            const ringEntity = document.getElementById(ringId);
            const greenValue = Math.floor((value / 100) * 255);
            const redValue = 255 - greenValue;
            const color = `rgb(${redValue}, ${greenValue}, 0)`;
            ringEntity.setAttribute('color', color);

            // Atualiza o preenchimento do gauge (theta-length)
            const thetaLength = (value / 100) * 360;  // Converte a porcentagem em graus
            ringEntity.setAttribute('theta-length', thetaLength);
        }

        // Função para inicializar os gauges com valores aleatórios
        function initializeGauges() {
            let oeeValue = getRandomInitialValue();
            let dispValue = getRandomInitialValue();
            let perfValue = getRandomInitialValue();
            let qualValue = getRandomInitialValue();

            // Atualiza os gauges com os valores iniciais
            updateGauge(oeeValue, 'text-OEE', 'ring-OEE');
            updateGauge(dispValue, 'text-Disponibilidade', 'ring-Disponibilidade');
            updateGauge(perfValue, 'text-Performance', 'ring-Performance');
            updateGauge(qualValue, 'text-Qualidade', 'ring-Qualidade');
        }

        // Função para atualizar os valores de todos os gauges de forma gradual
        function randomUpdate() {
            let oeeValue = parseInt(document.getElementById('text-OEE').getAttribute('value').split(': ')[1].replace('%', ''));
            let dispValue = parseInt(document.getElementById('text-Disponibilidade').getAttribute('value').split(': ')[1].replace('%', ''));
            let perfValue = parseInt(document.getElementById('text-Performance').getAttribute('value').split(': ')[1].replace('%', ''));
            let qualValue = parseInt(document.getElementById('text-Qualidade').getAttribute('value').split(': ')[1].replace('%', ''));

            // Gera novos valores aleatórios gradualmente
            oeeValue = getRandomValue(oeeValue);
            dispValue = getRandomValue(dispValue);
            perfValue = getRandomValue(perfValue);
            qualValue = getRandomValue(qualValue);

            // Atualiza os gauges
            updateGauge(oeeValue, 'text-OEE', 'ring-OEE');
            updateGauge(dispValue, 'text-Disponibilidade', 'ring-Disponibilidade');
            updateGauge(perfValue, 'text-Performance', 'ring-Performance');
            updateGauge(qualValue, 'text-Qualidade', 'ring-Qualidade');
        }

        // Inicializa os gauges com valores aleatórios ao carregar a página
        window.onload = initializeGauges;

        // Configura a atualização dos valores a cada 2 segundos
        setInterval(randomUpdate, 2000);

        // Função para exibir os gauges ao clicar no botão
        document.getElementById('statusButton').addEventListener('click', () => {
            const gauges = document.querySelectorAll('a-entity');
            gauges.forEach(gauge => gauge.setAttribute('visible', true));
        });
    </script>
</body>
</html>
